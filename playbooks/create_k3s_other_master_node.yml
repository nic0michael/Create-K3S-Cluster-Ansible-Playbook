- name: Create Other Master Node
  hosts: localhost
  gather_facts: false
  vars:
    node_name: "{{ node_name }}"
    master_node_ip_address: "{{ master_node_ip_address }}"
    k3s_token: "{{ k3s_token }}"  # Set your K3S token here
    dest_file: "/opt/k3s/{{ destination_file }}"
  tasks:
    - name: Execute k3s_node_maker.j2 template for OTHER_MASTER_NODE
      template:
        src: ../templates/k3s_node_maker.j2
        dest: "{{ dest_file }}"
      vars:
        node_type: "{{ node_type }}"
        node_name: "{{ node_name }}"
        master_node_ip_address: "{{ master_node_ip_address }}"
        k3s_token: "{{ k3s_token }}"

    - name: Change file permissions of other_master_node.sh
      become: true  # This will escalate privileges if required
      file:
        path: "{{ dest_file }}"
        mode: "775"

  - meta: end_play

- name: Run Create Node Shell Script
  hosts: your_target_hosts
  become: yes  

  vars:
    dest_file: "/opt/k3s/{{ destination_file }}"

  tasks:
    - name: Execute the shell script
      shell: "{{ dest_file }}"
