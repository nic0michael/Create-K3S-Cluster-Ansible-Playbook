- name: Create Primary Master Node
  hosts: localhost
  gather_facts: false
  vars:
    node_name: "{{ node_name }}"
    master_node_ip_address: "{{ master_node_ip_address }}"
    dest_file: "/opt/k3s/{{ destination_file }}"
  tasks:
    - name: Execute k3s_node_maker.j2 template for 1ST_MASTER_NODE
      template:
        src: ../templates/k3s_node_maker.j2
        dest: "{{ dest_file }}"
      vars:
        node_type: "{{ node_type }}"
        node_name: "{{ node_name }}"
        master_node_ip_address: "{{ master_node_ip_address }}"

    - name: Change file permissions of other_master_node.sh
      become: true  # This will escalate privileges if required
      file:
        path: "{{ dest_file }}"
        mode: "775"

    - name: Create SCP script
      copy:
        content: |
          #!/bin/bash

          # Replace placeholders with actual values
          SSH_USER="nickm"
          MASTER_NODE_IP="10.154.2.80"
          SCRIPT_PATH="/opt/k3s/1st_master_node.sh"
          DESTINATION="/opt/k3s/1st_master_node.sh"

          # Run SCP command
          scp -o StrictHostKeyChecking=no "$SCRIPT_PATH" "$SSH_USER@$MASTER_NODE_IP:$DESTINATION"
        dest: "{{ scp_script_path }}"
        mode: "0755"  # Adjust permissions as needed

    - name: Run SCP script to copy 1st_master_node.sh
      command: "{{ scp_script_path }}"



    


